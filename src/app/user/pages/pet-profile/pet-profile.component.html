<app-loader *ngIf="this.races.length <= 0"></app-loader>
<div class="profile" *ngIf="this.races.length >= 1">
    <div class="profile__container">
        <label for="profilePicture" class="profile__container__picture--label">
            <img
              src="assets/images/pet-avatar.webp"
              alt="pet-avatar"
              class="profile__container__picture--image"
              *ngIf="!selectedImage"
            />
            <input
              type="file"
              id="profilePicture"
              accept="image/*"
              (change)="onImageSelected($event)"
              style="display: none;"
            />
            <img
              [src]="selectedImage"
              alt="pet-avatar"
              class="profile__container__picture--image"
              *ngIf="selectedImage"
            />
            <div class="profile__container__picture--overlay" *ngIf="!selectedImage">
              <p>Haz clic para subir una imagen</p>
            </div>
        </label>
        <div class="profile__container__items">
            <app-progress-bar [currentStep]="1"></app-progress-bar>
            <form [formGroup]="petForm" (ngSubmit)="createPet()">
                <h1 class="profile__container__items--title">Perfil de tu mascota</h1>
                <div class="profile__container__items__item">
                    <input 
                        type="text"
                        id="name"
                        name="name"
                        formControlName="name"
                        class="profile__container__items__item--input"
                        [ngClass]="{ 'is-valid': isFieldValid('name'), 'is-invalid': isFieldInvalid('name') }"
                        (input)="onInputChanged($event)"
                        required
                        >
                        <label for="name" class="profile__container__items__item--label">Nombre de tu mascota</label>
                        <div class="profile__container__items__item--validation" *ngIf="isFieldInvalid('name')">
                            <fa-icon [icon]="faExclamationCircle"></fa-icon> 
                            <p>{{getErrorMessage('name')}}</p>
                        </div>
                </div>
                <div class="row justify-content-around ">
                    <div class="col-sm-12 col-md-6 col-lg-6 profile__container__items__item">
                        <mat-form-field>
                            <mat-label>Fecha de nacimiento (opcional)</mat-label>
                            <input (click)="picker.open()" formControlName="birth_date" matInput [matDatepicker]="picker">
                            <mat-hint>MM/DD/YYYY</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="picker">
                              <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                            </mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>   
                       <div class="profile__container__items__item--validation" *ngIf="isFieldInvalid('birth_date')">
                            <fa-icon [icon]="faExclamationCircle"></fa-icon> 
                            <p *ngIf="petForm.get('birth_date')?.errors?.['required']">La fecha de nacimiento es requerida.</p>
                        </div>   
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6 profile__container__items__item">
                        <mat-form-field>
                            <mat-select 
                                name="race_id" 
                                id="race_id" 
                                [formControl]="raceCtrl"
                                #raceSelect
                                [ngClass]="{ 'is-valid': isFieldValid('race_id'), 'is-invalid': isFieldInvalid('race_id')}"
                                (input)="onInputChanged($event)"
                                placeholder="Seleccione una raza"
                                (keydown.enter)="$event.preventDefault()"
                                >
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="raceFilterCtrl"></ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let race of (filteredRaces | async)" [value]="race.id">
                                    {{race.name}}
                                </mat-option>
                            </mat-select>
                            <div class="profile__container__items__item--validation" *ngIf="isFieldInvalid('race_id')">
                                <fa-icon [icon]="faExclamationCircle"></fa-icon> 
                                <p>{{getErrorMessage('race_id')}}</p>
                            </div>
                        </mat-form-field>
                        
                    </div>
                </div>
                <div class="profile__container__items__item">
                    <mat-form-field>
                        <mat-select 
                            placeholder="Seleccione el género"
                            name="gender" 
                            id="gender" 
                            formControlName="gender" 
                            [ngClass]="{ 'is-valid': isFieldValid('gender'), 'is-invalid': isFieldInvalid('gender')}"
                            (input)="onInputChanged($event)">
                            <mat-option value="">Género de la mascota</mat-option>
                            <mat-option value="male">Macho</mat-option>
                            <mat-option value="female">Hembra</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="profile__container__items__item--validation" *ngIf="isFieldInvalid('gender')">
                        <fa-icon [icon]="faExclamationCircle"></fa-icon> 
                        <p>{{getErrorMessage('gender')}}</p>
                    </div>
                </div>
                <div class="profile__container__items__item">
                    <textarea 
                        type="text"
                        id="pet_information"
                        name="pet_information"
                        formControlName="pet_information"
                        class="profile__container__items__item--input"
                        [ngClass]="{ 'is-valid': isFieldValid('pet_information'), 'is-invalid': isFieldInvalid('pet_information')}"
                        (input)="onInputChanged($event)"
                        ></textarea>
                        <label for="pet_information" class="profile__container__items__item--label">Características</label>
                        <div class="profile__container__items__item--validation" *ngIf="isFieldInvalid('pet_information')">
                            <fa-icon [icon]="faExclamationCircle"></fa-icon> 
                            <p>{{getErrorMessage('pet_information')}}</p>
                        </div>
                </div>
                <div *ngIf="unknowError" class="profile__container__items__item--error">
                    <fa-icon [icon]="faExclamationCircle"></fa-icon>
                    <p>{{errorMessage}}</p>
                </div>
                <div class="profile__container__items__item--button">
                    <button [disabled]="submitting || petForm.invalid">
                        {{btnValue}}
                        <fa-icon *ngIf="submitting" [icon]="faSpinner" [spin]="true"></fa-icon>
                        <fa-icon *ngIf="!submitting" [icon]="faChevronRight"></fa-icon>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>